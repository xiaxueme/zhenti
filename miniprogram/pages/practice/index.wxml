<view class="container">
  <view class="header">刷题</view>
  <view class="progress">
    <view class="progress-bar"><view class="progress-fill" style="width: {{progressPercent}}%;"></view></view>
    <view class="progress-text">{{currentIndex+1}} / {{questions.length}}</view>
  </view>

  <block wx:if="{{current}}">
    <view class="question">
      <view class="q-title">{{currentIndex+1}}. {{current.title}}</view>
    <block wx:if="{{current.type==='single'}}">
      <radio-group bindchange="onSelect">
        <block wx:for="{{current.options}}" wx:for-item="opt" wx:for-index="idx" wx:key="idx">
          <label class="option"><radio value="{{idx}}" /> {{opt}}</label>
        </block>
      </radio-group>
    </block>
    <block wx:if="{{current.type==='multiple'}}">
      <checkbox-group bindchange="onMultipleChange">
        <block wx:for="{{current.options}}" wx:for-item="opt" wx:for-index="idx" wx:key="idx">
          <label class="option"><checkbox value="{{idx}}" /> {{opt}}</label>
        </block>
      </checkbox-group>
    </block>
    <block wx:if="{{current.type==='judgment'}}">
      <radio-group bindchange="onSelect">
        <label class="option"><radio value="true" /> 正确</label>
        <label class="option"><radio value="false" /> 错误</label>
      </radio-group>
    </block>
    <block wx:if="{{current.type==='text'}}">
      <textarea placeholder="请输入你的答案" bindinput="onInput" value="{{answerText}}"></textarea>
    </block>
    </view>
  </block>
  <block wx:else>
    <view class="question">正在加载题目，请稍候或返回重试</view>
  </block>
  <block wx:if="{{results[currentIndex]!==undefined}}">
    <view class="answer-reveal">
      <view>本题答案：</view>
      <block wx:if="{{current.type==='single' || current.type==='multiple'}}">
        <view>{{formatOptions(current.options, current.answer)}}</view>
      </block>
      <block wx:if="{{current.type==='judgment'}}">
        <view>{{current.answer ? '正确' : '错误'}}</view>
      </block>
      <block wx:if="{{current.type==='text'}}">
        <view>{{current.answer || '（无标准答案）'}}</view>
      </block>
    </view>
  </block>

  <view class="controls">
    <button bindtap="prev">上一题</button>
    <button bindtap="submitAnswer">提交本题</button>
    <button bindtap="next">下一题</button>
  </view>

  <view style="margin-top:12px; display:flex; gap:8rpx; align-items:center;">
    <button bindtap="finishQuiz">完成并评分</button>
    <view class="feedback">{{statusText}}</view>
    <block wx:if="{{results[currentIndex]!==undefined}}">
      <view class="result {{results[currentIndex] ? 'correct' : 'wrong'}}">{{results[currentIndex] ? '正确' : '错误'}}</view>
    </block>
  </view>

  <view class="status">{{statusText}}</view>
</view>
